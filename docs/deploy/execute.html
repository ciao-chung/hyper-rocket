<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>執行佈署(deploy:execute)</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/hyper-rocket/logo.png">
    <link rel="manifest" href="/hyper-rocket/manifest.json">
    <link rel="mask-icon" href="/hyper-rocket/icon.png" color="#1bd5e3">
    <link rel="apple-touch-icon" href="/hyper-rocket/icon.png">
    <meta name="description" content="">
    <meta name="theme-color" content="#1bd5e3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/hyper-rocket/icon.png">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="keywords" content="Hyper Rocket">
    <meta name="og:title" content="Hyper Rocket">
    <meta name="og:site_name" content="Hyper Rocket">
    <meta name="og:image" content="https://ciao-chung.github.io/hyper-rocket/logo.png">
    <meta name="og:description" content="Hyper Rocket">
    
    <link rel="preload" href="/hyper-rocket/assets/css/0.styles.93a425e4.css" as="style"><link rel="preload" href="/hyper-rocket/assets/js/app.4393260f.js" as="script"><link rel="preload" href="/hyper-rocket/assets/js/2.daf7a04b.js" as="script"><link rel="preload" href="/hyper-rocket/assets/js/9.bd779bc3.js" as="script"><link rel="preload" href="/hyper-rocket/assets/js/3.75cb8508.js" as="script"><link rel="prefetch" href="/hyper-rocket/assets/js/10.98c3b305.js"><link rel="prefetch" href="/hyper-rocket/assets/js/11.f1eb56d5.js"><link rel="prefetch" href="/hyper-rocket/assets/js/12.191dc66c.js"><link rel="prefetch" href="/hyper-rocket/assets/js/13.6327b4f3.js"><link rel="prefetch" href="/hyper-rocket/assets/js/14.fd62a670.js"><link rel="prefetch" href="/hyper-rocket/assets/js/15.3de3939c.js"><link rel="prefetch" href="/hyper-rocket/assets/js/16.cddae4e0.js"><link rel="prefetch" href="/hyper-rocket/assets/js/4.3ea03653.js"><link rel="prefetch" href="/hyper-rocket/assets/js/5.40b83fb8.js"><link rel="prefetch" href="/hyper-rocket/assets/js/6.fe0d8327.js"><link rel="prefetch" href="/hyper-rocket/assets/js/7.d5eb02ac.js"><link rel="prefetch" href="/hyper-rocket/assets/js/8.b680cab3.js">
    <link rel="stylesheet" href="/hyper-rocket/assets/css/0.styles.93a425e4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hyper-rocket/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/hyper-rocket/" aria-current="page" class="sidebar-link">hyper-rocket</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>佈署</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hyper-rocket/deploy/execute.html" aria-current="page" class="active sidebar-link">執行佈署(deploy:execute)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hyper-rocket/deploy/execute.html#選項" class="sidebar-link">選項</a></li><li class="sidebar-sub-header"><a href="/hyper-rocket/deploy/execute.html#佈署階段" class="sidebar-link">佈署階段</a></li><li class="sidebar-sub-header"><a href="/hyper-rocket/deploy/execute.html#佈署設定檔" class="sidebar-link">佈署設定檔</a></li><li class="sidebar-sub-header"><a href="/hyper-rocket/deploy/execute.html#commandarray、remotecommandarray" class="sidebar-link">CommandArray、RemoteCommandArray</a></li><li class="sidebar-sub-header"><a href="/hyper-rocket/deploy/execute.html#hooks" class="sidebar-link">Hooks</a></li></ul></li><li><a href="/hyper-rocket/deploy/executeEnv.html" class="sidebar-link">佈署環境變數(DEPLOY_ENV)說明</a></li><li><a href="/hyper-rocket/deploy/executeVue.html" class="sidebar-link">Vue Site佈署</a></li><li><a href="/hyper-rocket/deploy/executeNuxt.html" class="sidebar-link">Nuxt Site佈署</a></li><li><a href="/hyper-rocket/deploy/executeLaravel.html" class="sidebar-link">Laravel佈署</a></li><li><a href="/hyper-rocket/deploy/execute/hooks.html" class="sidebar-link">Hooks</a></li><li><a href="/hyper-rocket/deploy/execute/commandArray.html" class="sidebar-link">設定檔 - 指令陣列/遠端指令陣列</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="執行佈署-deploy-execute"><a href="#執行佈署-deploy-execute" class="header-anchor">#</a> 執行佈署(deploy:execute)</h1> <h2 id="選項"><a href="#選項" class="header-anchor">#</a> 選項</h2> <ul><li>config: deploy config檔案絕對路徑</li> <li>dump: Dump佈署設定檔(不執行任何佈署動作)</li> <li>dumpEnv: Dump出所有的Deploy相關環境變數(不執行任何佈署動作)</li> <li>migrate: Publish完成後自動執行Laravel Migrate(僅Laravel佈署才有效)</li> <li>workdir: 工作目錄資料夾位置</li> <li>workdirName: 工作目錄名稱</li></ul> <h2 id="佈署階段"><a href="#佈署階段" class="header-anchor">#</a> 佈署階段</h2> <ul><li>fetch: 取得原始碼</li> <li>build: 建立要發佈的code</li> <li>publish: 發佈, 通常為執行rsync</li> <li>extra-service: 額外服務, 例如laravel的queue worker設定</li> <li>cleanup: 清除佈署指令建立的暫存工作目錄</li> <li>ci: 佈署完成或失敗通知, 目前可透過email, slack, line notify做通知</li></ul> <h3 id="跳過指定階段"><a href="#跳過指定階段" class="header-anchor">#</a> 跳過指定階段</h3> <p>透過本指令的選項--skip</p> <p>可一次跳過多個指定階段</p> <p>方便測試佈署設定檔的正確性使用</p> <div class="language-bash extra-class"><pre class="language-bash"><code>hyper-rocket deploy:execute -x <span class="token punctuation">\</span>
  -c deploy-config.yml <span class="token punctuation">\</span>
  --skip fetch <span class="token punctuation">\</span>
  --skip ci 
</code></pre></div><h2 id="佈署設定檔"><a href="#佈署設定檔" class="header-anchor">#</a> 佈署設定檔</h2> <blockquote><p>可使用hyper-rocket deploy:create-config --help指令來查看如何產生範例設定檔</p></blockquote> <ul><li>type(optional): String, 佈署類型, 以下為可使用類型
<ul><li>default: 預設</li> <li>vue</li> <li>laravel</li></ul></li> <li>info(required): Object, 佈署資訊</li> <li>source: Object, 原始碼來源物件</li> <li>build: Object, build設定</li></ul> <h3 id="info-佈署資訊"><a href="#info-佈署資訊" class="header-anchor">#</a> info(佈署資訊)</h3> <ul><li>label(required): String, 佈署名稱</li></ul> <h3 id="source-取得原始碼設定"><a href="#source-取得原始碼設定" class="header-anchor">#</a> source(取得原始碼設定)</h3> <ul><li>fetchType: String, 取得原始碼方式, 以下為可用方式</li> <li>git: String, 透過git</li> <li>path: String, 透過指定的絕對路徑取得</li> <li>repo(optional): String, fetchType設定為git的時候指定的git repo來源</li> <li>revision(optional): String, fetchType設定為git的時候指定的git版本, 可使用commit branch等, 佈署指令將使用git checkout切換版本</li> <li>folder(optional): String, 取得專案後的原始碼相對路徑, 預設為專案根目錄: .</li> <li>beforeFetchHook(optional): String, 執行的fetch動作前的Hook</li> <li>beforeFetchCommands(optional): Array, 執行的fetch動作前要執行的指令陣列(CommandArray), cwd為dist目錄</li> <li>afterFetchHook(optional): String, 完成的fetch動作後的Hook</li> <li>afterFetchCommands(optional): Array, 完成的fetch動作後要執行的指令陣列(CommandArray), cwd為dist目錄</li></ul> <h3 id="build"><a href="#build" class="header-anchor">#</a> build</h3> <p><strong>一般屬性</strong></p> <ul><li>distDir(optional): String, dist目錄, 也就是準備執行發佈的目錄, 以下為各佈署類型的預設值
<ul><li>vue: dist</li> <li>laravel: .(當下目錄)</li> <li>default: .(當下目錄)</li></ul></li> <li>beforeBuildHook(optional): String, 執行的build動作前的Hook</li> <li>beforeBuildCommands(optional): Array, 執行的build動作前要執行的指令陣列(CommandArray), cwd為dist目錄</li> <li>afterBuildHook(optional): String, 完成的build動作後的Hook</li> <li>afterBuildCommands(optional): Array, 完成的build動作後要執行的指令陣列(CommandArray), cwd為dist目錄</li></ul> <h3 id="rsync-optional"><a href="#rsync-optional" class="header-anchor">#</a> rsync(optional)</h3> <p><strong>一般屬性</strong></p> <ul><li>path: 要rsync到遠端的目錄</li> <li>tar(optional): 使用<code>tar</code>做壓縮來傳輸檔案加速</li> <li>meta: Array, 額外要rsync的檔案或目錄(rsync專案dist目錄之前會先做rsync), 每個陣列item可設定以下屬性
<ul><li>path: String, 與佈署設定檔的相對路徑檔案或目錄</li> <li>to: String, 要rsync到遠端的位置</li></ul></li> <li>beforeRsyncServerCommands(optional): Array, 執行的build動作前要執行的遠端指令陣列(RemoteCommandArray), cwd為dist目錄</li> <li>afterRsyncServerCommands(optional): Array, 完成的build動作後要執行的遠端指令陣列(RemoteCommandArray), cwd為dist目錄</li></ul> <h3 id="servers"><a href="#servers" class="header-anchor">#</a> servers</h3> <blockquote><p>ServerObject陣列, 定義多台Servers資訊</p></blockquote> <p><strong>ServerObject</strong></p> <p>可設定為操作本機或是遠端</p> <p>當local設定為true將設定為本機</p> <ul><li>label: String, Server資訊, 用於佈署指令log或notify識別用</li> <li>local: Boolean, 是否為本機</li> <li>host: String, 遠端主機host</li> <li>user: String, 登入遠端主機使用者帳號</li> <li>tag(optional): String, server tag, 可用做條件篩選, 例如cron job只佈署在指定tag的server上</li></ul> <h3 id="cron-optional"><a href="#cron-optional" class="header-anchor">#</a> cron(optional)</h3> <blockquote><p>可在rsync後設定cron job</p></blockquote> <p>佈署指令將建立cron job檔案在每一台server的/etc/cron.d/目錄下</p> <p><strong>可用屬性</strong></p> <ul><li>enabled(required): Boolean, 是否啟用佈署cron job功能</li> <li>name(required): String, cron job檔案名稱</li> <li>user(required): String, cron job檔案的owner</li> <li>comment(optional): String, cron job檔案上方的註解, 可用來註明此cron job用途</li> <li>onServerTag(optional): String, 只將cron job佈署在含有指定tag的server上</li> <li>rules(required): Array, cron job規則陣列, 例如: 0 5 * * * /sbin/shutdown -r now</li></ul> <h3 id="nuxtpm2config-optional"><a href="#nuxtpm2config-optional" class="header-anchor">#</a> nuxtPm2Config(optional)</h3> <blockquote><p>Nuxt佈署類型專用, 可在設定nuxt.js啟動的pm2 config</p></blockquote> <p><strong>可用屬性</strong></p> <ul><li>configFile(required): String, pm2設定檔樣板路徑(相對前端目錄的路徑)</li> <li>remoteConfigFilePath(required): String, 遠端pm2設定檔路徑</li> <li>appName(required): String, server pm2 process name(啟動process之前刪除舊的process用)</li> <li>variable(optional): Object, pm2 config檔案使用mustache.js的變數, 此屬性為設定檔內變數</li></ul> <h3 id="ci-optional"><a href="#ci-optional" class="header-anchor">#</a> ci(optional)</h3> <blockquote><p>Continue Integration, 在佈署成功/失敗的時候透過通訊軟體或Email通知</p></blockquote> <p><strong>注意</strong></p> <p>使用CI功能之前</p> <p>請先使用&quot;hyper-rocket ci:config&quot;指令建立CI設定檔</p> <p>CI設定檔將會建立在~/.hyper-rocket/.ci.yml中</p> <p><strong>可用屬性</strong></p> <ul><li>enable: Boolean, 是否啟用CI</li> <li>slack: Boolean, 是否使用Slack Webhook做CI</li> <li>lineNotify: Boolean, 是否使用Line Notify做CI</li> <li>mail: Array, 要進行通知的Email Address陣列</li></ul> <h2 id="commandarray、remotecommandarray"><a href="#commandarray、remotecommandarray" class="header-anchor">#</a> CommandArray、RemoteCommandArray</h2> <p>詳見: <a href="/deploy/execute/commandArray">deploy commandArray說明文件</a></p> <h2 id="hooks"><a href="#hooks" class="header-anchor">#</a> Hooks</h2> <p>詳見: <a href="/deploy/execute/hooks">deploy hook說明文件</a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hyper-rocket/" class="prev router-link-active">
        hyper-rocket
      </a></span> <span class="next"><a href="/hyper-rocket/deploy/executeEnv.html">
        佈署環境變數(DEPLOY_ENV)說明
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/hyper-rocket/assets/js/app.4393260f.js" defer></script><script src="/hyper-rocket/assets/js/2.daf7a04b.js" defer></script><script src="/hyper-rocket/assets/js/9.bd779bc3.js" defer></script><script src="/hyper-rocket/assets/js/3.75cb8508.js" defer></script>
  </body>
</html>
