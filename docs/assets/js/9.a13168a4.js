(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{378:function(r,t,e){"use strict";e.r(t);var a=e(49),o=Object(a.a)({},(function(){var r=this,t=r.$createElement,e=r._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":r.$parent.slotKey}},[e("h1",{attrs:{id:"執行佈署-deploy-execute"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#執行佈署-deploy-execute"}},[r._v("#")]),r._v(" 執行佈署(deploy:execute)")]),r._v(" "),e("h2",{attrs:{id:"選項"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#選項"}},[r._v("#")]),r._v(" 選項")]),r._v(" "),e("ul",[e("li",[r._v("config: deploy config檔案絕對路徑")]),r._v(" "),e("li",[r._v("dump: Dump佈署設定檔(不執行任何佈署動作)")]),r._v(" "),e("li",[r._v("dumpEnv: Dump出所有的Deploy相關環境變數(不執行任何佈署動作)")]),r._v(" "),e("li",[r._v("migrate: Publish完成後自動執行Laravel Migrate(僅Laravel佈署才有效)")]),r._v(" "),e("li",[r._v("workdir: 工作目錄資料夾位置")]),r._v(" "),e("li",[r._v("workdirName: 工作目錄名稱")])]),r._v(" "),e("h2",{attrs:{id:"佈署階段"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#佈署階段"}},[r._v("#")]),r._v(" 佈署階段")]),r._v(" "),e("ul",[e("li",[r._v("fetch: 取得原始碼")]),r._v(" "),e("li",[r._v("build: 建立要發佈的code")]),r._v(" "),e("li",[r._v("publish: 發佈, 通常為執行rsync")]),r._v(" "),e("li",[r._v("extra-service: 額外服務, 例如laravel的queue worker設定")]),r._v(" "),e("li",[r._v("cleanup: 清除佈署指令建立的暫存工作目錄")]),r._v(" "),e("li",[r._v("ci: 佈署完成或失敗通知, 目前可透過email, slack, line notify做通知")])]),r._v(" "),e("h3",{attrs:{id:"跳過指定階段"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#跳過指定階段"}},[r._v("#")]),r._v(" 跳過指定階段")]),r._v(" "),e("p",[r._v("透過本指令的選項--skip")]),r._v(" "),e("p",[r._v("可一次跳過多個指定階段")]),r._v(" "),e("p",[r._v("方便測試佈署設定檔的正確性使用")]),r._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[r._v("hyper-rocket deploy:execute -x "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v("\\")]),r._v("\n  -c deploy-config.yml "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v("\\")]),r._v("\n  --skip fetch "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v("\\")]),r._v("\n  --skip ci \n")])])]),e("h2",{attrs:{id:"佈署設定檔"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#佈署設定檔"}},[r._v("#")]),r._v(" 佈署設定檔")]),r._v(" "),e("blockquote",[e("p",[r._v("可使用hyper-rocket deploy:create-config --help指令來查看如何產生範例設定檔")])]),r._v(" "),e("ul",[e("li",[r._v("type(optional): String, 佈署類型, 以下為可使用類型\n"),e("ul",[e("li",[r._v("default: 預設")]),r._v(" "),e("li",[r._v("vue")]),r._v(" "),e("li",[r._v("laravel")])])]),r._v(" "),e("li",[r._v("info(required): Object, 佈署資訊")]),r._v(" "),e("li",[r._v("source: Object, 原始碼來源物件")]),r._v(" "),e("li",[r._v("build: Object, build設定")])]),r._v(" "),e("h3",{attrs:{id:"info-佈署資訊"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#info-佈署資訊"}},[r._v("#")]),r._v(" info(佈署資訊)")]),r._v(" "),e("ul",[e("li",[r._v("label(required): String, 佈署名稱")])]),r._v(" "),e("h3",{attrs:{id:"source-取得原始碼設定"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#source-取得原始碼設定"}},[r._v("#")]),r._v(" source(取得原始碼設定)")]),r._v(" "),e("ul",[e("li",[r._v("fetchType: String, 取得原始碼方式, 以下為可用方式")]),r._v(" "),e("li",[r._v("git: String, 透過git")]),r._v(" "),e("li",[r._v("path: String, 透過指定的絕對路徑取得")]),r._v(" "),e("li",[r._v("repo(optional): String, fetchType設定為git的時候指定的git repo來源")]),r._v(" "),e("li",[r._v("revision(optional): String, fetchType設定為git的時候指定的git版本, 可使用commit branch等, 佈署指令將使用git checkout切換版本")]),r._v(" "),e("li",[r._v("folder(optional): String, 取得專案後的原始碼相對路徑, 預設為專案根目錄: .")]),r._v(" "),e("li",[r._v("beforeFetchHook(optional): String, 執行的fetch動作前的Hook")]),r._v(" "),e("li",[r._v("beforeFetchCommands(optional): Array, 執行的fetch動作前要執行的指令陣列(CommandArray), cwd為dist目錄")]),r._v(" "),e("li",[r._v("afterFetchHook(optional): String, 完成的fetch動作後的Hook")]),r._v(" "),e("li",[r._v("afterFetchCommands(optional): Array, 完成的fetch動作後要執行的指令陣列(CommandArray), cwd為dist目錄")])]),r._v(" "),e("h3",{attrs:{id:"build"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#build"}},[r._v("#")]),r._v(" build")]),r._v(" "),e("p",[e("strong",[r._v("一般屬性")])]),r._v(" "),e("ul",[e("li",[r._v("distDir(optional): String, dist目錄, 也就是準備執行發佈的目錄, 以下為各佈署類型的預設值\n"),e("ul",[e("li",[r._v("vue: dist")]),r._v(" "),e("li",[r._v("laravel: .(當下目錄)")]),r._v(" "),e("li",[r._v("default: .(當下目錄)")])])]),r._v(" "),e("li",[r._v("beforeBuildHook(optional): String, 執行的build動作前的Hook")]),r._v(" "),e("li",[r._v("beforeBuildCommands(optional): Array, 執行的build動作前要執行的指令陣列(CommandArray), cwd為dist目錄")]),r._v(" "),e("li",[r._v("afterBuildHook(optional): String, 完成的build動作後的Hook")]),r._v(" "),e("li",[r._v("afterBuildCommands(optional): Array, 完成的build動作後要執行的指令陣列(CommandArray), cwd為dist目錄")])]),r._v(" "),e("h3",{attrs:{id:"rsync-optional"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rsync-optional"}},[r._v("#")]),r._v(" rsync(optional)")]),r._v(" "),e("p",[e("strong",[r._v("一般屬性")])]),r._v(" "),e("ul",[e("li",[r._v("path: 要rsync到遠端的目錄")]),r._v(" "),e("li",[r._v("meta: Array, 額外要rsync的檔案或目錄(rsync專案dist目錄之前會先做rsync), 每個陣列item可設定以下屬性\n"),e("ul",[e("li",[r._v("path: String, 與佈署設定檔的相對路徑檔案或目錄")]),r._v(" "),e("li",[r._v("to: String, 要rsync到遠端的位置")])])]),r._v(" "),e("li",[r._v("beforeRsyncServerCommands(optional): Array, 執行的build動作前要執行的遠端指令陣列(RemoteCommandArray), cwd為dist目錄")]),r._v(" "),e("li",[r._v("afterRsyncServerCommands(optional): Array, 完成的build動作後要執行的遠端指令陣列(RemoteCommandArray), cwd為dist目錄")])]),r._v(" "),e("h3",{attrs:{id:"servers"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#servers"}},[r._v("#")]),r._v(" servers")]),r._v(" "),e("blockquote",[e("p",[r._v("ServerObject陣列, 定義多台Servers資訊")])]),r._v(" "),e("p",[e("strong",[r._v("ServerObject")])]),r._v(" "),e("p",[r._v("可設定為操作本機或是遠端")]),r._v(" "),e("p",[r._v("當local設定為true將設定為本機")]),r._v(" "),e("ul",[e("li",[r._v("label: String, Server資訊, 用於佈署指令log或notify識別用")]),r._v(" "),e("li",[r._v("local: Boolean, 是否為本機")]),r._v(" "),e("li",[r._v("host: String, 遠端主機host")]),r._v(" "),e("li",[r._v("user: String, 登入遠端主機使用者帳號")]),r._v(" "),e("li",[r._v("tag(optional): String, server tag, 可用做條件篩選, 例如cron job只佈署在指定tag的server上")])]),r._v(" "),e("h3",{attrs:{id:"cron-optional"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cron-optional"}},[r._v("#")]),r._v(" cron(optional)")]),r._v(" "),e("blockquote",[e("p",[r._v("可在rsync後設定cron job")])]),r._v(" "),e("p",[r._v("佈署指令將建立cron job檔案在每一台server的/etc/cron.d/目錄下")]),r._v(" "),e("p",[e("strong",[r._v("可用屬性")])]),r._v(" "),e("ul",[e("li",[r._v("enabled(required): Boolean, 是否啟用佈署cron job功能")]),r._v(" "),e("li",[r._v("name(required): String, cron job檔案名稱")]),r._v(" "),e("li",[r._v("user(required): String, cron job檔案的owner")]),r._v(" "),e("li",[r._v("comment(optional): String, cron job檔案上方的註解, 可用來註明此cron job用途")]),r._v(" "),e("li",[r._v("onServerTag(optional): String, 只將cron job佈署在含有指定tag的server上")]),r._v(" "),e("li",[r._v("rules(required): Array, cron job規則陣列, 例如: 0 5 * * * /sbin/shutdown -r now")])]),r._v(" "),e("h3",{attrs:{id:"nuxtpm2config-optional"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nuxtpm2config-optional"}},[r._v("#")]),r._v(" nuxtPm2Config(optional)")]),r._v(" "),e("blockquote",[e("p",[r._v("Nuxt佈署類型專用, 可在設定nuxt.js啟動的pm2 config")])]),r._v(" "),e("p",[e("strong",[r._v("可用屬性")])]),r._v(" "),e("ul",[e("li",[r._v("configFile(required): String, pm2設定檔樣板路徑(相對前端目錄的路徑)")]),r._v(" "),e("li",[r._v("remoteConfigFilePath(required): String, 遠端pm2設定檔路徑")]),r._v(" "),e("li",[r._v("appName(required): String, server pm2 process name(啟動process之前刪除舊的process用)")]),r._v(" "),e("li",[r._v("variable(optional): Object, pm2 config檔案使用mustache.js的變數, 此屬性為設定檔內變數")])]),r._v(" "),e("h3",{attrs:{id:"ci-optional"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ci-optional"}},[r._v("#")]),r._v(" ci(optional)")]),r._v(" "),e("blockquote",[e("p",[r._v("Continue Integration, 在佈署成功/失敗的時候透過通訊軟體或Email通知")])]),r._v(" "),e("p",[e("strong",[r._v("注意")])]),r._v(" "),e("p",[r._v("使用CI功能之前")]),r._v(" "),e("p",[r._v('請先使用"hyper-rocket ci:config"指令建立CI設定檔')]),r._v(" "),e("p",[r._v("CI設定檔將會建立在~/.hyper-rocket/.ci.yml中")]),r._v(" "),e("p",[e("strong",[r._v("可用屬性")])]),r._v(" "),e("ul",[e("li",[r._v("enable: Boolean, 是否啟用CI")]),r._v(" "),e("li",[r._v("slack: Boolean, 是否使用Slack Webhook做CI")]),r._v(" "),e("li",[r._v("lineNotify: Boolean, 是否使用Line Notify做CI")]),r._v(" "),e("li",[r._v("mail: Array, 要進行通知的Email Address陣列")])]),r._v(" "),e("h2",{attrs:{id:"commandarray、remotecommandarray"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#commandarray、remotecommandarray"}},[r._v("#")]),r._v(" CommandArray、RemoteCommandArray")]),r._v(" "),e("p",[r._v("詳見: "),e("a",{attrs:{href:"/deploy/execute/commandArray"}},[r._v("deploy commandArray說明文件")])]),r._v(" "),e("h2",{attrs:{id:"hooks"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hooks"}},[r._v("#")]),r._v(" Hooks")]),r._v(" "),e("p",[r._v("詳見: "),e("a",{attrs:{href:"/deploy/execute/hooks"}},[r._v("deploy hook說明文件")])])])}),[],!1,null,null,null);t.default=o.exports}}]);